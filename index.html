<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moshe Welcher | Full Stack Developer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['"Fira Code"', 'monospace'],
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    colors: {
                        editor: {
                            bg: '#1e1e2e',
                            sidebar: '#181825',
                            active: '#313244',
                            text: '#cdd6f4',
                            comment: '#6c7086',
                            keyword: '#cba6f7',
                            string: '#a6e3a1',
                            func: '#89b4fa',
                            number: '#fab387',
                            class: '#f9e2af'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #181825; 
        }
        ::-webkit-scrollbar-thumb {
            background: #45475a; 
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #585b70; 
        }

        /* Blinking Cursor */
        .cursor-blink {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Line Numbers (Handled via JS now for stability) */
        .code-line {
            display: flex;
            align-items: flex-start;
            line-height: 1.6;
        }
        
        .line-number {
            color: #45475a;
            min-width: 3rem;
            padding-right: 1rem;
            text-align: right;
            user-select: none;
            border-right: 1px solid #313244;
            margin-right: 1rem;
            flex-shrink: 0;
            font-family: 'Fira Code', monospace;
        }

        /* Sidebar Transitions */
        .sidebar-transition {
            transition: width 0.3s ease-in-out;
        }
        
        /* Text hider for collapsed sidebar */
        .sidebar-collapsed .sidebar-text {
            display: none;
        }
        
        .sidebar-collapsed .sidebar-item {
            justify-content: center;
            padding-left: 0;
            padding-right: 0;
        }
        
        .sidebar-collapsed .sidebar-icon {
            margin-right: 0;
            font-size: 1.25rem; 
        }
        
        /* Tooltip logic for collapsed state */
        .sidebar-collapsed .sidebar-item:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: #1e1e2e;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 50;
            margin-left: 10px;
            border: 1px solid #45475a;
        }

        /* Typewriter Cursor */
        .typewriter-cursor {
            display: inline-block;
            width: 3px; /* Width of the cursor */
            background-color: #cba6f7; /* editor-keyword color */
            animation: blink 1s step-end infinite;
            margin-left: 4px;
            vertical-align: baseline;
            height: 1em; /* Scale with font size */
        }

    </style>
</head>
<body class="bg-gray-900 text-editor-text font-sans overflow-hidden h-screen selection:bg-editor-keyword selection:text-editor-bg">

    <!-- Main Layout -->
    <div class="flex h-full">

        <!-- Combined Sidebar -->
        <div id="main-sidebar" class="bg-editor-sidebar flex flex-col border-r border-gray-800 sidebar-transition w-64 relative z-30">
            
            <!-- Header / Toggle -->
            <div class="h-10 flex items-center justify-between px-4 border-b border-black">
                <span class="text-xs font-bold tracking-wider text-gray-400 uppercase sidebar-text">Explorer</span>
                <button onclick="toggleSidebar()" class="text-gray-500 hover:text-white focus:outline-none p-1 rounded hover:bg-gray-800 transition-colors">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
            
            <!-- Project Folder Header -->
            <div class="px-4 py-2 sidebar-text">
                <div class="flex items-center text-gray-300 text-sm font-bold">
                    <i class="fa-solid fa-chevron-down text-[10px] mr-2"></i>
                    <span class="text-editor-func truncate">MOSHE-WELCHER</span>
                </div>
            </div>
            
            <!-- File Tree Navigation -->
            <div class="flex-1 overflow-y-auto py-1 space-y-0.5">
                <!-- Home -->
                <div onclick="switchTab('home')" class="sidebar-item flex items-center text-gray-400 hover:text-white hover:bg-editor-active px-4 py-1.5 cursor-pointer text-sm group relative" data-tooltip="home.tsx">
                    <i class="fa-brands fa-react text-blue-400 mr-2 text-base sidebar-icon w-5 text-center"></i>
                    <span class="sidebar-text group-hover:text-editor-keyword transition-colors">home.tsx</span>
                </div>
                
                <!-- Projects -->
                <div onclick="switchTab('projects')" class="sidebar-item flex items-center text-gray-400 hover:text-white hover:bg-editor-active px-4 py-1.5 cursor-pointer text-sm group relative" data-tooltip="projects.json">
                    <i class="fa-solid fa-cubes text-yellow-400 mr-2 text-base sidebar-icon w-5 text-center"></i>
                    <span class="sidebar-text group-hover:text-editor-keyword transition-colors">projects.json</span>
                </div>

                <!-- About -->
                <div onclick="switchTab('about')" class="sidebar-item flex items-center text-gray-400 hover:text-white hover:bg-editor-active px-4 py-1.5 cursor-pointer text-sm group relative" data-tooltip="about-me.md">
                    <i class="fa-brands fa-markdown text-blue-300 mr-2 text-base sidebar-icon w-5 text-center"></i>
                    <span class="sidebar-text group-hover:text-editor-keyword transition-colors">about-me.md</span>
                </div>

                <!-- Contact -->
                <div onclick="switchTab('contact')" class="sidebar-item flex items-center text-gray-400 hover:text-white hover:bg-editor-active px-4 py-1.5 cursor-pointer text-sm group relative" data-tooltip="contact.css">
                    <i class="fa-brands fa-css3 text-blue-500 mr-2 text-base sidebar-icon w-5 text-center"></i>
                    <span class="sidebar-text group-hover:text-editor-keyword transition-colors">contact.css</span>
                </div>
            </div>

            <!-- Bottom Actions (Previously Activity Bar) -->
            <div class="border-t border-gray-800 p-2 space-y-1">
                <a href="https://github.com/moshewelcher" target="_blank" class="sidebar-item flex items-center text-gray-500 hover:text-white hover:bg-editor-active px-2 py-2 rounded cursor-pointer transition-colors relative" data-tooltip="GitHub Profile">
                    <i class="fa-brands fa-github text-xl sidebar-icon w-6 text-center"></i>
                    <span class="sidebar-text ml-3 text-sm">GitHub</span>
                </a>
                <div class="sidebar-item flex items-center text-gray-500 hover:text-white hover:bg-editor-active px-2 py-2 rounded cursor-pointer transition-colors relative" data-tooltip="Settings">
                    <i class="fa-solid fa-gear text-xl sidebar-icon w-6 text-center"></i>
                    <span class="sidebar-text ml-3 text-sm">Settings</span>
                </div>
            </div>
        </div>

        <!-- Editor Area -->
        <div class="flex-1 flex flex-col bg-editor-bg relative overflow-hidden">
            
            <!-- Tabs Bar -->
            <div class="h-10 bg-editor-sidebar flex items-center overflow-x-auto no-scrollbar border-b border-black">
                <div onclick="switchTab('home')" id="tab-home" class="tab active-tab px-4 h-full flex items-center space-x-2 text-sm border-t-2 border-editor-keyword bg-editor-bg cursor-pointer min-w-fit">
                    <i class="fa-brands fa-react text-blue-400 text-xs"></i>
                    <span>home.tsx</span>
                    <i class="fa-solid fa-xmark text-xs ml-2 hover:text-white text-gray-500"></i>
                </div>
                <div onclick="switchTab('projects')" id="tab-projects" class="tab px-4 h-full flex items-center space-x-2 text-sm border-t-2 border-transparent text-gray-500 hover:bg-editor-active cursor-pointer min-w-fit">
                    <i class="fa-solid fa-brackets-curly text-yellow-400 text-xs"></i>
                    <span>projects.json</span>
                </div>
                <div onclick="switchTab('about')" id="tab-about" class="tab px-4 h-full flex items-center space-x-2 text-sm border-t-2 border-transparent text-gray-500 hover:bg-editor-active cursor-pointer min-w-fit">
                    <i class="fa-brands fa-markdown text-blue-300 text-xs"></i>
                    <span>about-me.md</span>
                </div>
                <div onclick="switchTab('contact')" id="tab-contact" class="tab px-4 h-full flex items-center space-x-2 text-sm border-t-2 border-transparent text-gray-500 hover:bg-editor-active cursor-pointer min-w-fit">
                    <i class="fa-brands fa-css3 text-blue-500 text-xs"></i>
                    <span>contact.css</span>
                </div>
            </div>

            <!-- Breadcrumbs -->
            <div class="h-6 bg-editor-bg flex items-center px-4 text-xs text-gray-500 border-b border-gray-800">
                <span>moshe-welcher</span>
                <i class="fa-solid fa-chevron-right text-[10px] mx-2"></i>
                <span>src</span>
                <i class="fa-solid fa-chevron-right text-[10px] mx-2"></i>
                <span id="breadcrumb-file" class="text-gray-300">home.tsx</span>
            </div>
            
            <!-- Custom Status Message Area (for Contact form feedback) -->
            <div id="status-message" class="hidden absolute top-0 left-1/2 -translate-x-1/2 mt-2 px-4 py-2 text-xs rounded shadow-lg font-bold z-50 transition-opacity duration-300"></div>

            <!-- Main Content Area -->
            <div class="flex-1 overflow-y-auto relative font-mono text-sm md:text-base py-4 scroll-smooth" id="content-area">
                
                <!-- HOME PAGE -->
                <div id="page-home" class="page-content fade-in max-w-5xl">
                    <div class="code-line"><span class="text-editor-comment">// Welcome to my interactive portfolio.</span></div>
                    <div class="code-line"><span class="text-editor-comment">// Feel free to look around the source files.</span></div>
                    <div class="code-line">&nbsp;</div>
                    
                    <div class="code-line">
                        <span class="text-editor-keyword mr-2">const</span>
                        <span class="text-editor-func mr-2">Moshe</span>
                        <span class="text-editor-text mr-2">=</span>
                        <span class="text-editor-keyword">()</span>
                        <span class="text-editor-keyword mx-2">=&gt;</span>
                        <span class="text-yellow-300">{</span>
                    </div>

                    <div class="code-line">
                        <div class="pl-8">
                            <span class="text-editor-keyword mr-2">return</span>
                            <span class="text-gray-400">(</span>
                        </div>
                    </div>

                    <div class="code-line">
                        <div class="pl-12 border-l-2 border-gray-800 ml-4 my-2 w-full pr-4">
                            <!-- Animated Heading -->
                            <h1 id="typing-title" class="text-4xl md:text-6xl font-bold text-white mb-4 font-sans tracking-tight min-h-[1.5em]">
                                <!-- Content injected by JS -->
                            </h1>
                            
                            <p class="text-xl text-gray-400 mb-6 font-sans max-w-2xl">
                                A agressive <span class="text-editor-string">Full Stack Developer</span> building robust applications for the modern web.
                            </p>
                            
                            <div class="flex flex-wrap gap-4 mt-6 font-sans">
                                <button onclick="switchTab('projects')" class="px-6 py-3 bg-editor-func text-black font-bold rounded hover:bg-blue-300 transition-all transform hover:scale-105 shadow-lg shadow-blue-500/20">
                                    View Projects
                                </button>
                                <button onclick="switchTab('contact')" class="px-6 py-3 border border-editor-keyword text-editor-keyword font-bold rounded hover:bg-editor-keyword hover:text-black transition-all">
                                    Contact Me
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="code-line">
                        <div class="pl-8">
                            <span class="text-gray-400">)</span>
                            <span class="text-gray-500">;</span>
                        </div>
                    </div>
                    <div class="code-line text-yellow-300">}</div>
                    <div class="code-line">&nbsp;</div>
                    <div class="code-line">
                        <span class="text-editor-keyword">export default</span>
                        <span class="text-editor-func ml-2">Moshe</span>
                        <span class="text-gray-500">;</span>
                    </div>

                    <!-- Stats Grid -->
                     <div class="code-line mt-8">
                        <div class="w-full px-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 font-sans">
                                <div class="bg-editor-active p-6 rounded-lg border border-gray-700 hover:border-editor-keyword transition-colors group">
                                    <i class="fa-solid fa-code text-3xl text-editor-string mb-4 group-hover:scale-110 transition-transform block"></i>
                                    <h3 class="text-lg font-bold text-white">Clean Code</h3>
                                    <p class="text-gray-400 text-sm mt-2">Writing maintainable, scalable, and efficient software solutions.</p>
                                </div>
                                <div class="bg-editor-active p-6 rounded-lg border border-gray-700 hover:border-editor-keyword transition-colors group">
                                    <i class="fa-solid fa-server text-3xl text-editor-number mb-4 group-hover:scale-110 transition-transform block"></i>
                                    <h3 class="text-lg font-bold text-white">Backend</h3>
                                    <p class="text-gray-400 text-sm mt-2">Robust APIs, database design, and server-side architecture.</p>
                                </div>
                                <div class="bg-editor-active p-6 rounded-lg border border-gray-700 hover:border-editor-keyword transition-colors group">
                                    <i class="fa-solid fa-book-open text-3xl text-editor-func mb-4 group-hover:scale-110 transition-transform block"></i>
                                    <h3 class="text-lg font-bold text-white">Continuous Learning</h3>
                                    <p class="text-gray-400 text-sm mt-2">Always exploring new technologies and methodologies.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PROJECTS PAGE -->
                <div id="page-projects" class="page-content hidden max-w-5xl">
                    <div class="code-line mb-6">
                        <span class="text-editor-keyword">const</span>
                        <span class="text-editor-class ml-2">projects</span>
                        <span class="text-editor-text mx-2">=</span>
                        <span class="text-yellow-300">[</span>
                    </div>

                    <!-- Projects Grid -->
                    <div class="code-line">
                         <div class="pl-4 w-full pr-4">
                            <!-- Dynamic Container -->
                            <div id="projects-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 font-sans">
                                <!-- Loading State -->
                                <div class="col-span-full text-gray-500 italic">
                                    <i class="fa-solid fa-circle-notch fa-spin mr-2"></i>
                                    Fetching data from GitHub API...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="code-line mt-6">
                        <span class="text-yellow-300">]</span>
                        <span class="text-gray-500">;</span>
                    </div>
                </div>

                <!-- ABOUT PAGE -->
                <div id="page-about" class="page-content hidden max-w-5xl">
                    <div class="code-line"><span class="text-editor-comment">// about-me.md</span></div>
                    
                    <div class="code-line">
                        <div class="w-full px-4 pt-4">
                            <div class="prose prose-invert max-w-none font-sans">
                                <h2 class="text-3xl text-white font-bold mb-4 flex items-center">
                                    <span class="text-editor-keyword mr-2">#</span> About Me
                                </h2>
                                <p class="text-gray-300 mb-6 leading-relaxed">
                                    Hello! I'm <span class="text-white font-bold">Moshe Welcher</span>, a developer based in the US. I have always been interested in programming. My journey started when I began programming Python on a Raspberry Pi 2 Model B, which sparked my deep interest in building robust and scalable software solutions.
                                </p>
                                
                                <h3 class="text-xl text-white font-bold mb-3 flex items-center">
                                    <span class="text-editor-keyword mr-2">##</span> Tech Stack
                                </h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-brands fa-js text-yellow-300"></i> <span>JavaScript</span></div>
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-brands fa-google text-blue-400"></i> <span>Google Apps Script</span></div>
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-brands fa-python text-blue-300"></i> <span>Python</span></div>
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-brands fa-node text-green-500"></i> <span>Node.js</span></div>
                                    <div class="flex items-center space-x-2 text-gray-400">
                                        <img src="https://forums.jtechforums.org/uploads/default/optimized/2X/5/5890c40c648110080e2692cac43e2f0e715fe885_2_180x180.png" alt="JTech" class="w-5 h-5 object-contain opacity-80"> 
                                        <span>JTech</span>
                                    </div>
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-solid fa-code text-blue-400"></i> <span>VS Code</span></div>
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-solid fa-wand-magic-sparkles text-purple-400"></i> <span>Google AI Studio</span></div>
                                    <div class="flex items-center space-x-2 text-gray-400"><i class="fa-brands fa-git-alt text-red-500"></i> <span>Git</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONTACT PAGE -->
                <div id="page-contact" class="page-content hidden max-w-5xl">
                    <div class="code-line mb-4">
                        <span class="text-editor-keyword">.contact-info</span>
                        <span class="text-yellow-300"> {</span>
                    </div>
                    
                    <div class="code-line">
                         <div class="pl-4 md:pl-8 w-full font-sans pr-4">
                             <!-- Demo Form (Visual Only) -->
                            <form onsubmit="handleContactFormSubmit(event);" class="space-y-4 bg-editor-active p-6 rounded-lg border border-gray-700 mb-8">
                                <div class="text-gray-500 text-xs font-mono mb-2">// Send a message directly</div>
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">display: <span class="text-editor-string">"Name"</span>;</label>
                                    <input id="contact-name" type="text" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white focus:outline-none focus:border-editor-func transition-colors" placeholder="Your Name">
                                </div>
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">display: <span class="text-editor-string">"Email"</span>;</label>
                                    <input id="contact-email" type="email" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white focus:outline-none focus:border-editor-func transition-colors" placeholder="your@email.com">
                                </div>
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">display: <span class="text-editor-string">"Message"</span>;</label>
                                    <textarea id="contact-message" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white focus:outline-none focus:border-editor-func transition-colors h-32" placeholder="Hello..."></textarea>
                                </div>
                                <button class="w-full bg-editor-keyword text-black font-bold py-2 rounded hover:bg-white transition-colors flex items-center justify-center">
                                    <i class="fa-solid fa-paper-plane mr-2"></i> sendMessage()
                                </button>
                            </form>
                            
                            <!-- Dynamic Contact Links -->
                            <div id="contact-links" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="col-span-full text-gray-500 italic">
                                    <i class="fa-solid fa-circle-notch fa-spin mr-2"></i>
                                    Fetching contact info...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="code-line mt-4">
                        <span class="text-yellow-300">}</span>
                    </div>
                </div>

            </div>

            <!-- Status Bar -->
            <div class="h-6 bg-editor-keyword text-black flex items-center justify-between px-4 text-xs font-bold select-none z-20">
                <div class="flex items-center space-x-4">
                    <span class="flex items-center"><i class="fa-solid fa-code-branch mr-1"></i> main*</span>
                    <span class="flex items-center"><i class="fa-regular fa-circle-xmark mr-1"></i> 0 Errors</span>
                    <span class="flex items-center"><i class="fa-solid fa-triangle-exclamation mr-1"></i> 0 Warnings</span>
                </div>
                <div class="flex items-center space-x-4 hidden md:flex">
                    <span>Ln 12, Col 45</span>
                    <span>UTF-8</span>
                    <span>JavaScript React</span>
                    <span class="flex items-center"><i class="fa-solid fa-bell ml-1"></i></span>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // Replace this with your actual email to ensure the contact form always works,
        // even if the GitHub API doesn't return a public email address.
        const EMAIL_FALLBACK = "welchermoshe@gmail.com"; 

        // Global var to store fetched email
        window.githubEmail = null;

        // Utility to display in-app status messages
        function showCustomAlert(message, isError = false) {
            const statusArea = document.getElementById('status-message');
            if (statusArea) {
                statusArea.textContent = message;
                statusArea.classList.remove('hidden', 'bg-editor-string/50', 'text-editor-string', 'bg-red-800/50', 'text-red-400');
                
                if (isError) {
                    statusArea.classList.add('bg-red-800/50', 'text-red-400');
                } else {
                    statusArea.classList.add('bg-editor-string/50', 'text-editor-string');
                }

                statusArea.style.opacity = '1';
                setTimeout(() => {
                    statusArea.style.opacity = '0';
                    setTimeout(() => statusArea.classList.add('hidden'), 300); // Wait for fade out
                }, 3000);
            }
        }

        // --- GLOBAL FUNCTIONS EXPLICITLY DEFINED FOR INLINE HANDLERS ---

        // Contact Form Handler (Called by onsubmit)
        window.handleContactFormSubmit = function(event) {
            event.preventDefault();
            
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;
            
            // Use fetched email from GitHub or fallback to the config constant
            const recipient = window.githubEmail || EMAIL_FALLBACK;
            
            const subject = `Contact from Portfolio: ${name}`;
            const body = `Name: ${name}\nContact Email: ${email}\n\nMessage:\n${message}`;
            
            window.location.href = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            showCustomAlert('Opening default email client...');
        }

        // Toggle Sidebar (Combined Functionality)
        window.toggleSidebar = function() {
            const sidebar = document.getElementById('main-sidebar');
            
            if (sidebar.classList.contains('w-64')) {
                // Collapse
                sidebar.classList.remove('w-64');
                sidebar.classList.add('w-16', 'sidebar-collapsed');
            } else {
                // Expand
                sidebar.classList.remove('w-16', 'sidebar-collapsed');
                sidebar.classList.add('w-64');
            }
        }

        // Tab Switching Logic (Called by onclick)
        window.switchTab = function(tabId) {
            // Hide all contents
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show specific content
            const content = document.getElementById(`page-${tabId}`);
            content.classList.remove('hidden');
            
            // Recalculate line numbers when switching tabs (forces refresh)
            updateLineNumbers(content);

            // Animate content opacity
            content.style.opacity = '0';
            setTimeout(() => content.style.opacity = '1', 50);
            
            // Reset all tabs styling
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active-tab', 'bg-editor-bg', 'border-editor-keyword');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Style active tab
            const activeTab = document.getElementById(`tab-${tabId}`);
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('active-tab', 'bg-editor-bg', 'border-editor-keyword', 'text-white');
            
            // Update Breadcrumbs
            const fileExtensions = {
                'home': 'home.tsx',
                'projects': 'projects.json',
                'about': 'about-me.md',
                'contact': 'contact.css'
            };
            document.getElementById('breadcrumb-file').innerText = fileExtensions[tabId];
        }
        
        // --- GitHub API Logic (Helpers) ---

        // Exponential backoff for retries
        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // Not a rate limit error, proceed
                        return response;
                    }
                } catch (error) {
                    console.error("Fetch attempt failed:", error);
                }

                // If rate limited or failed, wait and retry
                const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            throw new Error("API call failed after multiple retries due to throttling or network error.");
        }


        // Fetch GitHub Projects
        async function loadGitHubProjects() {
            const username = 'MosheWelcher';
            const container = document.getElementById('projects-container');
            
            try {
                // Fetch repos sorted by update date
                const response = await fetchWithBackoff(`https://api.github.com/users/${username}/repos?sort=updated&direction=desc`);
                if (!response.ok) throw new Error('GitHub API limit exceeded or error');
                
                let repos = await response.json();
                
                // Filter: Remove forks if you want, or keep them. Taking top 6 most recently updated.
                // repos = repos.filter(repo => !repo.fork); 
                const displayRepos = repos.slice(0, 6);

                const html = displayRepos.map(repo => {
                    const langColor = repo.language === 'JavaScript' ? 'text-yellow-300' : 
                                      repo.language === 'Python' ? 'text-blue-300' : 
                                      repo.language === 'HTML' ? 'text-orange-400' : 'text-gray-300';

                    return `
                    <div class="bg-editor-active rounded-lg border border-gray-700 overflow-hidden hover:border-editor-string transition-all hover:-translate-y-1 group flex flex-col">
                        <div class="h-2 bg-editor-string w-full"></div>
                        <div class="p-6 flex-1 flex flex-col">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-xl font-bold text-white group-hover:text-editor-string transition-colors truncate pr-2" title="${repo.name}">
                                    ${repo.name}
                                </h3>
                                <div class="flex space-x-3 text-gray-400 flex-shrink-0">
                                    <a href="${repo.html_url}" target="_blank" class="hover:text-white transition-colors"><i class="fa-brands fa-github text-lg"></i></a>
                                    ${repo.homepage ? `<a href="${repo.homepage}" target="_blank" class="hover:text-white transition-colors"><i class="fa-solid fa-up-right-from-square text-lg"></i></a>` : ''}
                                </div>
                            </div>
                            <p class="text-gray-400 text-sm mb-4 line-clamp-3 flex-1">
                                ${repo.description || 'No description provided.'}
                            </p>
                            <div class="flex flex-wrap gap-2 mt-auto">
                                ${repo.language ? `<span class="px-2 py-1 bg-gray-800 ${langColor} text-xs rounded border border-gray-700">${repo.language}</span>` : ''}
                                <span class="px-2 py-1 bg-gray-800 text-gray-400 text-xs rounded border border-gray-700 flex items-center">
                                    <i class="fa-regular fa-star mr-1.5 text-yellow-500"></i>${repo.stargazers_count}
                                </span>
                                <span class="px-2 py-1 bg-gray-800 text-gray-400 text-xs rounded border border-gray-700 flex items-center">
                                    <i class="fa-solid fa-code-branch mr-1.5"></i>${repo.forks_count}
                                </span>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
                
                container.innerHTML = html;

            } catch (error) {
                container.innerHTML = `
                    <div class="col-span-full text-red-400 font-mono p-4 border border-red-900 bg-red-900/20 rounded">
                        // Error fetching GitHub data<br>
                        console.error("${error.message}");
                    </div>
                `;
            }
        }

        // Fetch GitHub Profile Data
        async function loadGitHubProfile() {
            const username = 'MosheWelcher';
            const container = document.getElementById('contact-links');
            
            try {
                const response = await fetchWithBackoff(`https://api.github.com/users/${username}`);
                if (!response.ok) throw new Error('GitHub API error');
                
                const data = await response.json();

                // --- SAVE EMAIL GLOBALLY FOR FORM ---
                if (data.email) {
                    window.githubEmail = data.email;
                }
                
                // Determine which email to display: API email -> Fallback -> null
                // REMOVED SAFETY CHECK: Now explicitly shows the fallback if no API email is found.
                const displayEmail = data.email || EMAIL_FALLBACK;

                // Build HTML for available contact info
                let html = '';
                
                // GitHub Link (Always available)
                html += `
                <a href="${data.html_url}" target="_blank" class="flex items-center p-4 bg-editor-sidebar border border-gray-800 hover:border-white rounded transition-colors group">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-white group-hover:bg-white group-hover:text-black transition-colors">
                        <i class="fa-brands fa-github"></i>
                    </div>
                    <div class="ml-4">
                        <div class="text-gray-500 text-xs">GitHub</div>
                        <div class="text-white truncate">${data.login}</div>
                    </div>
                </a>`;

                // Email Section - Always Show
                html += `
                <a href="mailto:${displayEmail}" class="flex items-center p-4 bg-editor-sidebar border border-gray-800 hover:border-editor-string rounded transition-colors group">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-editor-string group-hover:bg-editor-string group-hover:text-black transition-colors">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                    <div class="ml-4">
                        <div class="text-gray-500 text-xs">Email</div>
                        <div class="text-white truncate">${displayEmail}</div>
                    </div>
                </a>`;

                // Blog/Website
                if (data.blog) {
                     let blogUrl = data.blog.startsWith('http') ? data.blog : `https://${data.blog}`;
                     html += `
                    <a href="${blogUrl}" target="_blank" class="flex items-center p-4 bg-editor-sidebar border border-gray-800 hover:border-editor-func rounded transition-colors group">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-editor-func group-hover:bg-editor-func group-hover:text-black transition-colors">
                            <i class="fa-solid fa-globe"></i>
                        </div>
                        <div class="ml-4">
                            <div class="text-gray-500 text-xs">Website</div>
                            <div class="text-white truncate">${data.blog}</div>
                        </div>
                    </a>`;
                }

                // Location
                if (data.location) {
                     html += `
                    <div class="flex items-center p-4 bg-editor-sidebar border border-gray-800">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-editor-keyword">
                            <i class="fa-solid fa-location-dot"></i>
                        </div>
                        <div class="ml-4">
                            <div class="text-gray-500 text-xs">Location</div>
                            <div class="text-white truncate">${data.location}</div>
                        </div>
                    </div>`;
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error("Profile fetch error", error);
                container.innerHTML = `<div class="text-red-400 col-span-full">// Error loading contact info</div>`;
            }
        }

        // Line Number Fixer
        function updateLineNumbers(container) {
            const lines = container.querySelectorAll('.code-line');
            lines.forEach((line, index) => {
                // Check if line number already exists
                let numSpan = line.querySelector('.line-number');
                if (!numSpan) {
                    numSpan = document.createElement('div');
                    numSpan.className = 'line-number';
                    line.prepend(numSpan);
                }
                numSpan.textContent = index + 1;
            });
        }

        // Typing Animation Logic
        async function runTypingEffect() {
            const titleElement = document.getElementById('typing-title');
            if (!titleElement || titleElement.hasAttribute('data-typed')) return;
            
            titleElement.setAttribute('data-typed', 'true');
            titleElement.innerHTML = ''; // Clear initial content
            
            const segments = [
                { text: "Hello, I'm ", className: "text-white" },
                { text: "Moshe", className: "text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600" },
                { text: ".", className: "text-white" }
            ];

            // Create cursor
            const cursor = document.createElement('span');
            cursor.className = 'typewriter-cursor';
            titleElement.appendChild(cursor);

            for (const segment of segments) {
                const span = document.createElement('span');
                if (segment.className) span.className = segment.className;
                titleElement.insertBefore(span, cursor);
                
                for (const char of segment.text) {
                    span.textContent += char;
                    await new Promise(r => setTimeout(r, 100 + Math.random() * 50));
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Add fade-in transition styles dynamically
            const style = document.createElement('style');
            style.innerHTML = `
                .page-content { transition: opacity 0.3s ease-in-out; }
                .active-tab { border-top-color: #cba6f7 !important; color: #cdd6f4 !important; background-color: #1e1e2e; }
            `;
            document.head.appendChild(style);
            
            // Run initial line number calculation for all pages
            document.querySelectorAll('.page-content').forEach(updateLineNumbers);

            // Initial Render
            switchTab('home');
            
            // Start Typing Animation
            runTypingEffect();

            // Load Projects
            loadGitHubProjects();
            // Load Profile
            loadGitHubProfile();
        });
    </script>
</body>
</html>
